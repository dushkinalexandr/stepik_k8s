# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ k8s

---
kubectl - cli —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∞—Å—Ç–µ—Ä–æ–º k8s
—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
–ü–æ–¥—Ä–æ–±–Ω–µ–µ:
https://kubernetes.io/docs/reference/kubectl/overview/


# install kubctl
https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/

curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl

chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl


# check
kubectl version --client


##########################
# Deb
sudo apt-get update && sudo apt-get install -y apt-transport-https
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
echo "deb https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee -a /etc/apt/sources.list.d/kubernetes.list
sudo apt-get update
sudo apt-get install -y kubectl

#########################
# RHEL
sudo cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
sudo yum install -y kubectl


---
Minikube - —ç—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ –æ–¥–Ω–æ–π –ù–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –≤ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–∞—Ö –∏–¥–µ–π –∏ –≤ –æ–±—É—á–µ–Ω–∏–∏.
https://kubernetes.io/ru/docs/tasks/tools/install-minikube/


# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Minikube —Å –ø–æ–º–æ—â—å—é –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  && chmod +x minikube

# –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª Minikube –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –ª—é–±–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /usr/local/bin/
sudo install minikube /usr/local/bin/

# Install conntrack
sudo apt-get install -y conntrack

# conntrack to be installed in root's path /usr/sbin
type conntrack 
conntrack —è–≤–ª—è–µ—Ç—Å—è /usr/sbin/conntrack
cd /usr/bin/
ln -s /usr/sbin/conntrack conntrack

# Install cri-dockerd
# Run these commands as root
###Install GO###
wget https://storage.googleapis.com/golang/getgo/installer_linux
chmod +x ./installer_linux
./installer_linux
source ~/.bash_profile

git clone https://github.com/Mirantis/cri-dockerd.git
cd cri-dockerd
mkdir bin
go build -o bin/cri-dockerd
mkdir -p /usr/local/bin
install -o root -g root -m 0755 bin/cri-dockerd /usr/local/bin/cri-dockerd
cp -a packaging/systemd/* /etc/systemd/system
sed -i -e 's,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,' /etc/systemd/system/cri-docker.service
systemctl daemon-reload
systemctl enable cri-docker.service
systemctl enable --now cri-docker.socket

# install crictl
VERSION="v1.24.1"
wget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz
sudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin
rm -f crictl-$VERSION-linux-amd64.tar.gz

# –∑–∞–ø—É—Å—Ç–∏—Ç—å 
minikube start
minikube start ‚Äîvm-driver=none

# minikube start –º–æ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –±—ç–∫–µ–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ ‚Äîvm-driver 
# ‚Äîvm-driver=none, —á—Ç–æ–± –æ–Ω–æ –Ω–∞ —Ö–æ—Å—Ç–µ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å. 
# ‚Äîvm-driver=dosker - —Å –±—ç–∫–æ–º –¥–æ–∫–µ—Ä–∞ —è –≤—ã–≥—Ä–µ–±–ª–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –∑–∞–¥–∞–Ω–∏–∏

üòÑ  minikube v1.27.1 –Ω–∞ Ubuntu 20.04
‚ú®  Automatically selected the docker driver. Other choices: ssh, none, qemu2 (experimental)
üìå  Using Docker driver with root privileges
üëç  –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è control plane —É–∑–µ–ª minikube –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ minikube
üöú  –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ ...
üíæ  –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è Kubernetes v1.25.2 ...
    > preloaded-images-k8s-v18-v1...:  385.41 MiB / 385.41 MiB  100.00% 7.05 Mi
    > gcr.io/k8s-minikube/kicbase:  387.11 MiB / 387.11 MiB  100.00% 4.96 MiB p
    > gcr.io/k8s-minikube/kicbase:  0 B [________________________] ?% ? p/s 47s
üî•  Creating docker container (CPUs=2, Memory=9900MB) ...
üê≥  –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Kubernetes v1.25.2 –Ω–∞ Docker 20.10.18 ...
    ‚ñ™ Generating certificates and keys ...
    ‚ñ™ Booting up control plane ...
    ‚ñ™ Configuring RBAC rules ...
üîé  –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Kubernetes –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è ...
    ‚ñ™ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ gcr.io/k8s-minikube/storage-provisioner:v5
üåü  –í–∫–ª—é—á–µ–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è: storage-provisioner, default-storageclass
üí°  kubectl not found. If you need it, try: 'minikube kubectl -- get pods -A'
üèÑ  –ì–æ—Ç–æ–≤–æ! kubectl –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ "minikube" –∏ "default" –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é



# –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏
minikube status

minikube
type: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured


# config profile
minikube profile list
|----------|-----------|---------|--------------|------|---------|---------|-------|--------|
| Profile  | VM Driver | Runtime |      IP      | Port | Version | Status  | Nodes | Active |
|----------|-----------|---------|--------------|------|---------|---------|-------|--------|
| minikube | docker    | docker  | 192.168.49.2 | 8443 | v1.25.2 | Running |     1 | *      |
|----------|-----------|---------|--------------|------|---------|---------|-------|--------|


# –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
minicube stop

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
minicube delete







